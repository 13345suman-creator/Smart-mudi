const dictionary = {
    bn: {
        home: "‡¶π‡ßã‡¶Æ", inventory: "‡¶∏‡ßç‡¶ü‡¶ï", billing: "‡¶¨‡¶ø‡¶≤", reports: "‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü",
        add: "‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®", save: "‡¶∏‡ßá‡¶≠ ‡¶ï‡¶∞‡ßÅ‡¶®", cancel: "‡¶¨‡¶æ‡¶§‡¶ø‡¶≤", delete: "‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®",
        edit: "‡¶è‡¶°‡¶ø‡¶ü", close: "‡¶¨‡¶®‡ßç‡¶ß", search: "‡¶∏‡¶æ‡¶∞‡ßç‡¶ö ‡¶ï‡¶∞‡ßÅ‡¶®", total: "‡¶Æ‡ßã‡¶ü",
        quantity: "‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£", price: "‡¶¶‡¶æ‡¶Æ", product: "‡¶™‡¶£‡ßç‡¶Ø",
        todaySales: "‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø", totalProducts: "‡¶Æ‡ßã‡¶ü ‡¶™‡¶£‡ßç‡¶Ø",
        lowStockAlert: "‡¶ï‡¶Æ ‡¶∏‡ßç‡¶ü‡¶ï", quickAdd: "‡¶¶‡ßç‡¶∞‡ßÅ‡¶§ ‡¶Ø‡ßã‡¶ó", newBill: "‡¶®‡¶§‡ßÅ‡¶® ‡¶¨‡¶ø‡¶≤",
        viewReports: "‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ‡¶¶‡ßá‡¶ñ‡ßÅ‡¶®", dailySummary: "‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∏‡¶æ‡¶∞‡¶æ‡¶Ç‡¶∂",
        addProduct: "‡¶®‡¶§‡ßÅ‡¶® ‡¶™‡¶£‡ßç‡¶Ø", productName: "‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ",
        buyPrice: "‡¶ï‡ßá‡¶®‡¶æ ‡¶¶‡¶æ‡¶Æ", sellPrice: "‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø ‡¶¶‡¶æ‡¶Æ", stockQty: "‡¶∏‡ßç‡¶ü‡¶ï ‡¶™‡¶∞‡¶ø‡¶Æ‡¶æ‡¶£",
        unit: "‡¶è‡¶ï‡¶ï", lowStockWarning: "‡¶ï‡¶Æ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ", noProducts: "‡¶ï‡ßã‡¶®‡ßã ‡¶™‡¶£‡ßç‡¶Ø ‡¶®‡ßá‡¶á",
        createBill: "‡¶¨‡¶ø‡¶≤ ‡¶§‡ßà‡¶∞‡¶ø ‡¶ï‡¶∞‡ßÅ‡¶®", addToBill: "‡¶¨‡¶ø‡¶≤‡ßá ‡¶Ø‡ßã‡¶ó ‡¶ï‡¶∞‡ßÅ‡¶®",
        printBill: "‡¶¨‡¶ø‡¶≤ ‡¶™‡ßç‡¶∞‡¶ø‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®", clearBill: "‡¶¨‡¶ø‡¶≤ ‡¶Æ‡ßÅ‡¶õ‡ßÅ‡¶®", billTotal: "‡¶Æ‡ßã‡¶ü ‡¶ü‡¶æ‡¶ï‡¶æ",
        dailyReport: "‡¶¶‡ßà‡¶®‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü", weeklyReport: "‡¶∏‡¶æ‡¶™‡ßç‡¶§‡¶æ‡¶π‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü",
        monthlyReport: "‡¶Æ‡¶æ‡¶∏‡¶ø‡¶ï ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü", topProducts: "‡¶∏‡¶¨‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø",
        purchaseSuggestion: "‡¶ï‡ßá‡¶®‡¶æ‡¶∞ ‡¶™‡¶∞‡¶æ‡¶Æ‡¶∞‡ßç‡¶∂",
        kg: "‡¶ï‡ßá‡¶ú‡¶ø", litre: "‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞", packet: "‡¶™‡ßç‡¶Ø‡¶æ‡¶ï‡ßá‡¶ü", piece: "‡¶™‡¶ø‡¶∏",
        saved: "‡¶∏‡ßá‡¶≠ ‡¶π‡¶Ø‡¶º‡ßá ‡¶ó‡ßá‡¶õ‡ßá!", deleted: "‡¶Æ‡ßÅ‡¶õ‡ßá ‡¶´‡ßá‡¶≤‡¶æ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!",
        addedToBill: "‡¶¨‡¶ø‡¶≤‡ßá ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!", lowStockMsg: "‡¶∏‡¶§‡¶∞‡ßç‡¶ï‡¶§‡¶æ: ‡¶ï‡¶Æ ‡¶∏‡ßç‡¶ü‡¶ï!",
        voiceNotSupported: "‡¶≠‡¶Ø‡¶º‡ßá‡¶∏ ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá‡¶° ‡¶®‡¶Ø‡¶º", offlineMode: "‡¶Ö‡¶´‡¶≤‡¶æ‡¶á‡¶® ‡¶Æ‡ßã‡¶°‡ßá ‡¶Ü‡¶õ‡ßá",
        scanBarcode: "‡¶¨‡¶æ‡¶∞‡¶ï‡ßã‡¶° ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®", barcodeScanner: "‡¶¨‡¶æ‡¶∞‡¶ï‡ßã‡¶° ‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞",
        upiPayment: "UPI ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü", receivePayment: "‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ó‡ßç‡¶∞‡¶π‡¶£ ‡¶ï‡¶∞‡ßÅ‡¶®",
        upiId: "UPI ‡¶Ü‡¶á‡¶°‡¶ø", enterUpiId: "‡¶Ü‡¶™‡¶®‡¶æ‡¶∞ UPI ‡¶Ü‡¶á‡¶°‡¶ø ‡¶¶‡¶ø‡¶®",
        merchantName: "‡¶¶‡ßã‡¶ï‡¶æ‡¶®‡ßá‡¶∞ ‡¶®‡¶æ‡¶Æ", scanToPay: "‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶ï‡¶∞‡ßá ‡¶™‡ßá‡¶Æ‡ßá‡¶®‡ßç‡¶ü ‡¶ï‡¶∞‡ßÅ‡¶®",
        paymentApps: "Google Pay, PhonePe, Paytm ‡¶∏‡¶¨‡¶á ‡¶∏‡¶æ‡¶™‡ßã‡¶∞‡ßç‡¶ü‡ßá‡¶°",
        startScan: "‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßÅ‡¶®", stopScan: "‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶® ‡¶¨‡¶®‡ßç‡¶ß ‡¶ï‡¶∞‡ßÅ‡¶®",
        productAdded: "‡¶™‡¶£‡ßç‡¶Ø ‡¶Ø‡ßã‡¶ó ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá", settings: "‡¶∏‡ßá‡¶ü‡¶ø‡¶Ç‡¶∏",
        cameraError: "‡¶ï‡ßç‡¶Ø‡¶æ‡¶Æ‡ßá‡¶∞‡¶æ ‡¶Ö‡ßç‡¶Ø‡¶æ‡¶ï‡ßç‡¶∏‡ßá‡¶∏ ‡¶™‡¶æ‡¶ì‡¶Ø‡¶º‡¶æ ‡¶Ø‡¶æ‡¶ö‡ßç‡¶õ‡ßá ‡¶®‡¶æ", scannerStopped: "‡¶∏‡ßç‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡¶æ‡¶∞ ‡¶¨‡¶®‡ßç‡¶ß"
    },
    hi: {
        home: "‡§π‡•ã‡§Æ", inventory: "‡§∏‡•ç‡§ü‡•â‡§ï", billing: "‡§¨‡§ø‡§≤", reports: "‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü",
        add: "‡§ú‡•ã‡§°‡§º‡•á‡§Ç", save: "‡§∏‡•á‡§µ ‡§ï‡§∞‡•á‡§Ç", cancel: "‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç", delete: "‡§π‡§ü‡§æ‡§è‡§Ç",
        edit: "‡§è‡§°‡§ø‡§ü", close: "‡§¨‡§Ç‡§¶", search: "‡§ñ‡•ã‡§ú‡•á‡§Ç", total: "‡§ï‡•Å‡§≤",
        quantity: "‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ", price: "‡§ï‡•Ä‡§Æ‡§§", product: "‡§â‡§§‡•ç‡§™‡§æ‡§¶",
        todaySales: "‡§Ü‡§ú ‡§ï‡•Ä ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä", totalProducts: "‡§ï‡•Å‡§≤ ‡§â‡§§‡•ç‡§™‡§æ‡§¶",
        lowStockAlert: "‡§ï‡§Æ ‡§∏‡•ç‡§ü‡•â‡§ï", quickAdd: "‡§ú‡§≤‡•ç‡§¶‡•Ä ‡§ú‡•ã‡§°‡§º‡•á‡§Ç", newBill: "‡§®‡§Ø‡§æ ‡§¨‡§ø‡§≤",
        viewReports: "‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü ‡§¶‡•á‡§ñ‡•á‡§Ç", dailySummary: "‡§Ü‡§ú ‡§ï‡§æ ‡§∏‡§æ‡§∞‡§æ‡§Ç‡§∂",
        addProduct: "‡§®‡§Ø‡§æ ‡§â‡§§‡•ç‡§™‡§æ‡§¶", productName: "‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§ï‡§æ ‡§®‡§æ‡§Æ",
        buyPrice: "‡§ñ‡§∞‡•Ä‡§¶ ‡§Æ‡•Ç‡§≤‡•ç‡§Ø", sellPrice: "‡§µ‡§ø‡§ï‡•ç‡§∞‡§Ø ‡§Æ‡•Ç‡§≤‡•ç‡§Ø", stockQty: "‡§∏‡•ç‡§ü‡•â‡§ï ‡§Æ‡§æ‡§§‡•ç‡§∞‡§æ",
        unit: "‡§á‡§ï‡§æ‡§à", lowStockWarning: "‡§ï‡§Æ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä", noProducts: "‡§ï‡•ã‡§à ‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§®‡§π‡•Ä‡§Ç",
        createBill: "‡§¨‡§ø‡§≤ ‡§¨‡§®‡§æ‡§è‡§Ç", addToBill: "‡§¨‡§ø‡§≤ ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡•á‡§Ç",
        printBill: "‡§¨‡§ø‡§≤ ‡§™‡•ç‡§∞‡§ø‡§Ç‡§ü ‡§ï‡§∞‡•á‡§Ç", clearBill: "‡§¨‡§ø‡§≤ ‡§∏‡§æ‡§´ ‡§ï‡§∞‡•á‡§Ç", billTotal: "‡§ï‡•Å‡§≤ ‡§∞‡§æ‡§∂‡§ø",
        dailyReport: "‡§¶‡•à‡§®‡§ø‡§ï ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü", weeklyReport: "‡§∏‡§æ‡§™‡•ç‡§§‡§æ‡§π‡§ø‡§ï ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü",
        monthlyReport: "‡§Æ‡§æ‡§∏‡§ø‡§ï ‡§∞‡§ø‡§™‡•ã‡§∞‡•ç‡§ü", topProducts: "‡§ü‡•â‡§™ ‡§â‡§§‡•ç‡§™‡§æ‡§¶",
        purchaseSuggestion: "‡§ñ‡§∞‡•Ä‡§¶‡§æ‡§∞‡•Ä ‡§∏‡•Å‡§ù‡§æ‡§µ",
        kg: "‡§ï‡§ø‡§≤‡•ã", litre: "‡§≤‡•Ä‡§ü‡§∞", packet: "‡§™‡•à‡§ï‡•á‡§ü", piece: "‡§™‡•Ä‡§∏",
        saved: "‡§∏‡•á‡§µ ‡§π‡•ã ‡§ó‡§Ø‡§æ!", deleted: "‡§π‡§ü‡§æ ‡§¶‡§ø‡§Ø‡§æ ‡§ó‡§Ø‡§æ!",
        addedToBill: "‡§¨‡§ø‡§≤ ‡§Æ‡•á‡§Ç ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ!", lowStockMsg: "‡§ö‡•á‡§§‡§æ‡§µ‡§®‡•Ä: ‡§ï‡§Æ ‡§∏‡•ç‡§ü‡•â‡§ï!",
        voiceNotSupported: "‡§Ü‡§µ‡§æ‡§ú ‡§∏‡•Å‡§µ‡§ø‡§ß‡§æ ‡§â‡§™‡§≤‡§¨‡•ç‡§ß ‡§®‡§π‡•Ä‡§Ç", offlineMode: "‡§ë‡§´‡§≤‡§æ‡§á‡§® ‡§Æ‡•ã‡§° ‡§Æ‡•á‡§Ç",
        scanBarcode: "‡§¨‡§æ‡§∞‡§ï‡•ã‡§° ‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞‡•á‡§Ç", barcodeScanner: "‡§¨‡§æ‡§∞‡§ï‡•ã‡§° ‡§∏‡•ç‡§ï‡•à‡§®‡§∞",
        upiPayment: "UPI ‡§≠‡•Å‡§ó‡§§‡§æ‡§®", receivePayment: "‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§™‡•ç‡§∞‡§æ‡§™‡•ç‡§§ ‡§ï‡§∞‡•á‡§Ç",
        upiId: "UPI ‡§Ü‡§à‡§°‡•Ä", enterUpiId: "‡§Ö‡§™‡§®‡§æ UPI ‡§Ü‡§à‡§°‡•Ä ‡§¶‡§∞‡•ç‡§ú ‡§ï‡§∞‡•á‡§Ç",
        merchantName: "‡§¶‡•Å‡§ï‡§æ‡§® ‡§ï‡§æ ‡§®‡§æ‡§Æ", scanToPay: "‡§∏‡•ç‡§ï‡•à‡§® ‡§ï‡§∞‡§ï‡•á ‡§≠‡•Å‡§ó‡§§‡§æ‡§® ‡§ï‡§∞‡•á‡§Ç",
        paymentApps: "Google Pay, PhonePe, Paytm ‡§∏‡§≠‡•Ä ‡§∏‡§Æ‡§∞‡•ç‡§•‡§ø‡§§",
        startScan: "‡§∏‡•ç‡§ï‡•à‡§® ‡§∂‡•Å‡§∞‡•Ç ‡§ï‡§∞‡•á‡§Ç", stopScan: "‡§∏‡•ç‡§ï‡•à‡§® ‡§¨‡§Ç‡§¶ ‡§ï‡§∞‡•á‡§Ç",
        productAdded: "‡§â‡§§‡•ç‡§™‡§æ‡§¶ ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ", settings: "‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏",
        cameraError: "‡§ï‡•à‡§Æ‡§∞‡§æ ‡§è‡§ï‡•ç‡§∏‡•á‡§∏ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ", scannerStopped: "‡§∏‡•ç‡§ï‡•à‡§®‡§∞ ‡§¨‡§Ç‡§¶"
    },
    en: {
        home: "Home", inventory: "Stock", billing: "Bill", reports: "Reports",
        add: "Add", save: "Save", cancel: "Cancel", delete: "Delete",
        edit: "Edit", close: "Close", search: "Search", total: "Total",
        quantity: "Quantity", price: "Price", product: "Product",
        todaySales: "Today's Sales", totalProducts: "Total Products",
        lowStockAlert: "Low Stock", quickAdd: "Quick Add", newBill: "New Bill",
        viewReports: "View Reports", dailySummary: "Daily Summary",
        addProduct: "Add Product", productName: "Product Name",
        buyPrice: "Buy Price", sellPrice: "Sell Price", stockQty: "Stock Quantity",
        unit: "Unit", lowStockWarning: "Low Stock Warning", noProducts: "No Products",
        createBill: "Create Bill", addToBill: "Add to Bill",
        printBill: "Print Bill", clearBill: "Clear Bill", billTotal: "Bill Total",
        dailyReport: "Daily Report", weeklyReport: "Weekly Report",
        monthlyReport: "Monthly Report", topProducts: "Top Products",
        purchaseSuggestion: "Purchase Suggestions",
        kg: "Kg", litre: "Litre", packet: "Packet", piece: "Piece",
        saved: "Saved!", deleted: "Deleted!",
        addedToBill: "Added to Bill!", lowStockMsg: "Warning: Low Stock!",
        voiceNotSupported: "Voice not supported", offlineMode: "Working offline",
        scanBarcode: "Scan Barcode", barcodeScanner: "Barcode Scanner",
        upiPayment: "UPI Payment", receivePayment: "Receive Payment",
        upiId: "UPI ID", enterUpiId: "Enter your UPI ID",
        merchantName: "Shop Name", scanToPay: "Scan to Pay",
        paymentApps: "Google Pay, PhonePe, Paytm all supported",
        startScan: "Start Scan", stopScan: "Stop Scan",
        productAdded: "Product Added", settings: "Settings",
        cameraError: "Camera access denied", scannerStopped: "Scanner stopped"
    }
};

const enToBnMap = {
    "rice": "‡¶ö‡¶æ‡¶≤", "chal": "‡¶ö‡¶æ‡¶≤", "boiled rice": "‡¶∏‡ßá‡¶¶‡ßç‡¶ß ‡¶ö‡¶æ‡¶≤",
    "wheat": "‡¶ó‡¶Æ", "flour": "‡¶Ü‡¶ü‡¶æ", "atta": "‡¶Ü‡¶ü‡¶æ", "maida": "‡¶Æ‡¶Ø‡¶º‡¶¶‡¶æ",
    "paddy": "‡¶ß‡¶æ‡¶®", "corn": "‡¶≠‡ßÅ‡¶ü‡ßç‡¶ü‡¶æ", "makka": "‡¶≠‡ßÅ‡¶ü‡ßç‡¶ü‡¶æ",
    "dal": "‡¶°‡¶æ‡¶≤", "lentil": "‡¶°‡¶æ‡¶≤", "masoor dal": "‡¶Æ‡ßÅ‡¶∏‡ßÅ‡¶∞ ‡¶°‡¶æ‡¶≤",
    "moong dal": "‡¶Æ‡ßÅ‡¶ó ‡¶°‡¶æ‡¶≤", "chana dal": "‡¶ö‡¶æ‡¶®‡¶æ ‡¶°‡¶æ‡¶≤",
    "chhola": "‡¶õ‡ßã‡¶≤‡¶æ", "chickpeas": "‡¶õ‡ßã‡¶≤‡¶æ", "rajma": "‡¶∞‡¶æ‡¶ú‡¶Æ‡¶æ",
    "kidney beans": "‡¶∞‡¶æ‡¶ú‡¶Æ‡¶æ", "besan": "‡¶¨‡ßá‡¶∏‡¶®", "gram flour": "‡¶¨‡ßá‡¶∏‡¶®",
    "oil": "‡¶§‡ßá‡¶≤", "tel": "‡¶§‡ßá‡¶≤", "mustard oil": "‡¶∏‡¶∞‡¶∑‡ßá‡¶∞ ‡¶§‡ßá‡¶≤",
    "coconut oil": "‡¶®‡¶æ‡¶∞‡¶ï‡ßá‡¶≤ ‡¶§‡ßá‡¶≤", "sunflower oil": "‡¶∏‡ßÇ‡¶∞‡ßç‡¶Ø‡¶Æ‡ßÅ‡¶ñ‡ßÄ ‡¶§‡ßá‡¶≤",
    "ghee": "‡¶ò‡¶ø", "butter": "‡¶Æ‡¶æ‡¶ñ‡¶®",
    "sugar": "‡¶ö‡¶ø‡¶®‡¶ø", "chini": "‡¶ö‡¶ø‡¶®‡¶ø", "salt": "‡¶≤‡¶¨‡¶£", "lobon": "‡¶≤‡¶¨‡¶£",
    "turmeric": "‡¶π‡¶≤‡ßÅ‡¶¶", "chili": "‡¶≤‡¶ô‡ßç‡¶ï‡¶æ", "cumin": "‡¶ú‡¶ø‡¶∞‡¶æ",
    "coriander": "‡¶ß‡¶®‡¶ø‡¶Ø‡¶º‡¶æ", "mustard": "‡¶∏‡¶∞‡ßç‡¶∑‡ßá", "cardamom": "‡¶è‡¶≤‡¶æ‡¶ö",
    "cinnamon": "‡¶¶‡¶æ‡¶∞‡¶ö‡¶ø‡¶®‡¶ø", "cloves": "‡¶≤‡¶¨‡¶ô‡ßç‡¶ó", "black pepper": "‡¶ó‡ßã‡¶≤‡¶Æ‡¶∞‡¶ø‡¶ö",
    "bay leaf": "‡¶§‡ßá‡¶ú ‡¶™‡¶æ‡¶§‡¶æ", "ginger": "‡¶Ü‡¶¶‡¶æ", "garlic": "‡¶∞‡¶∏‡ßÅ‡¶®",
    "potato": "‡¶Ü‡¶≤‡ßÅ", "alu": "‡¶Ü‡¶≤‡ßÅ", "onion": "‡¶™‡ßá‡¶Å‡¶Ø‡¶º‡¶æ‡¶ú", "pyaj": "‡¶™‡ßá‡¶Å‡¶Ø‡¶º‡¶æ‡¶ú",
    "tomato": "‡¶ü‡¶Æ‡ßá‡¶ü‡ßã", "cauliflower": "‡¶´‡ßÅ‡¶≤‡¶ï‡¶™‡¶ø", "cabbage": "‡¶¨‡¶æ‡¶Å‡¶ß‡¶æ‡¶ï‡¶™‡¶ø",
    "spinach": "‡¶™‡¶æ‡¶≤‡¶Ç ‡¶∂‡¶æ‡¶ï", "carrot": "‡¶ó‡¶æ‡¶ú‡¶∞", "radish": "‡¶Æ‡ßÅ‡¶≤‡¶æ",
    "cucumber": "‡¶∂‡¶∏‡¶æ", "lemon": "‡¶≤‡ßá‡¶¨‡ßÅ", "mango": "‡¶Ü‡¶Æ",
    "banana": "‡¶ï‡¶≤‡¶æ", "apple": "‡¶Ü‡¶™‡ßá‡¶≤",
    "milk": "‡¶¶‡ßÅ‡¶ß", "egg": "‡¶°‡¶ø‡¶Æ", "paneer": "‡¶™‡¶®‡¶ø‡¶∞",
    "tea": "‡¶ö‡¶æ", "coffee": "‡¶ï‡¶´‡¶ø", "biscuit": "‡¶¨‡¶ø‡¶∏‡ßç‡¶ï‡ßÅ‡¶ü",
    "soap": "‡¶∏‡¶æ‡¶¨‡¶æ‡¶®", "shampoo": "‡¶∂‡ßç‡¶Ø‡¶æ‡¶Æ‡ßç‡¶™‡ßÅ", "toothpaste": "‡¶ü‡ßÅ‡¶•‡¶™‡ßá‡¶∏‡ßç‡¶ü",
    "detergent": "‡¶°‡¶ø‡¶ü‡¶æ‡¶∞‡¶ú‡ßá‡¶®‡ßç‡¶ü", "matchbox": "‡¶¶‡ßá‡¶∂‡¶≤‡¶æ‡¶á",
    "water": "‡¶ú‡¶≤", "cold drink": "‡¶†‡¶æ‡¶®‡ßç‡¶°‡¶æ ‡¶™‡¶æ‡¶®‡ßÄ‡¶Ø‡¶º", "juice": "‡¶ú‡ßÅ‡¶∏",
    "bread": "‡¶™‡¶æ‡¶â‡¶∞‡ßÅ‡¶ü‡¶ø", "cake": "‡¶ï‡ßá‡¶ï", "chocolate": "‡¶ö‡¶ï‡ßã‡¶≤‡ßá‡¶ü",
    "noodles": "‡¶ö‡¶æ‡¶â‡¶Æ‡¶ø‡¶®", "vermicelli": "‡¶∏‡ßá‡¶Æ‡¶æ‡¶á"
};

const enToHiMap = {
    "rice": "‡§ö‡§æ‡§µ‡§≤", "sugar": "‡§ö‡•Ä‡§®‡•Ä", "oil": "‡§§‡•á‡§≤",
    "wheat": "‡§ó‡•á‡§π‡•Ç‡§Ç", "flour": "‡§Ü‡§ü‡§æ", "dal": "‡§¶‡§æ‡§≤",
    "milk": "‡§¶‡•Ç‡§ß", "potato": "‡§Ü‡§≤‡•Ç", "onion": "‡§™‡•ç‡§Ø‡§æ‡§ú",
    "tomato": "‡§ü‡§Æ‡§æ‡§ü‡§∞", "salt": "‡§®‡§Æ‡§ï", "tea": "‡§ö‡§æ‡§Ø"
};

const app = {
    lang: 'bn',
    currentView: 'dashboard',
    db: null,
    currentBill: [],
    speechRecognition: null,
    isRecording: false,
    useLocalStorage: true,
    products: [],
    sales: [],
    html5QrCode: null,
    isScanning: false,
    shopSettings: {
        upiId: '',
        merchantName: '',
        currency: 'INR'
    },

    init() {
        try {
            this.loadSettings();
            this.initStorage();
            this.setupSpeechRecognition();
            this.updateDate();
            setInterval(() => this.updateDate(), 60000);
            
            window.addEventListener('online', () => this.showToast('Back online!'));
            window.addEventListener('offline', () => this.showToast(this.t('offlineMode')));
            
            this.render();
            console.log('App initialized successfully');
        } catch (error) {
            console.error('Init error:', error);
            this.showToast('Error starting app');
        }
    },

    loadSettings() {
        try {
            const saved = localStorage.getItem('shopSettings');
            if (saved) {
                this.shopSettings = JSON.parse(saved);
            }
        } catch (e) {
            console.error('Settings load error:', e);
        }
    },

    saveSettings() {
        try {
            localStorage.setItem('shopSettings', JSON.stringify(this.shopSettings));
        } catch (e) {
            console.error('Settings save error:', e);
        }
    },

    initStorage() {
        if ('indexedDB' in window) {
            const request = indexedDB.open('SmartMudiKhanaDB', 1);
            
            request.onerror = (e) => {
                console.log('IndexedDB failed, using localStorage');
                this.useLocalStorage = true;
                this.loadFromLocalStorage();
            };
            
            request.onsuccess = (e) => {
                try {
                    this.db = e.target.result;
                    this.useLocalStorage = false;
                    console.log('IndexedDB ready');
                    this.loadFromIndexedDB();
                } catch (err) {
                    console.error('IndexedDB success handler error:', err);
                    this.loadFromLocalStorage();
                }
            };
            
            request.onupgradeneeded = (e) => {
                try {
                    const db = e.target.result;
                    if (!db.objectStoreNames.contains('products')) {
                        const productStore = db.createObjectStore('products', { keyPath: 'id', autoIncrement: true });
                        productStore.createIndex('name', 'name', { unique: false });
                    }
                    if (!db.objectStoreNames.contains('sales')) {
                        const salesStore = db.createObjectStore('sales', { keyPath: 'id', autoIncrement: true });
                        salesStore.createIndex('date', 'date', { unique: false });
                    }
                } catch (err) {
                    console.error('Upgrade error:', err);
                }
            };
        } else {
            this.loadFromLocalStorage();
        }
    },

    loadFromLocalStorage() {
        try {
            this.products = JSON.parse(localStorage.getItem('products') || '[]');
            this.sales = JSON.parse(localStorage.getItem('sales') || '[]');
            console.log('Loaded from localStorage:', this.products.length, 'products');
        } catch (e) {
            console.error('localStorage error:', e);
            this.products = [];
            this.sales = [];
        }
    },

    async loadFromIndexedDB() {
        try {
            this.products = await this.getAllFromStore('products');
            this.sales = await this.getAllFromStore('sales');
            console.log('Loaded from IndexedDB:', this.products.length, 'products');
        } catch (e) {
            console.error('IndexedDB load error:', e);
            this.loadFromLocalStorage();
        }
    },

    getAllFromStore(storeName) {
        return new Promise((resolve, reject) => {
            if (!this.db) {
                resolve([]);
                return;
            }
            try {
                const transaction = this.db.transaction([storeName], 'readonly');
                const store = transaction.objectStore(storeName);
                const request = store.getAll();
                
                request.onsuccess = () => resolve(request.result || []);
                request.onerror = () => reject(request.error);
            } catch (e) {
                reject(e);
            }
        });
    },

    setLanguage(lang) {
        this.lang = lang;
        document.querySelectorAll('.lang-btn').forEach(btn => {
            btn.classList.remove('active');
            if ((lang === 'bn' && btn.textContent === '‡¶¨‡¶æ‡¶Ç‡¶≤‡¶æ') ||
                (lang === 'hi' && btn.textContent === '‡§π‡§ø‡§Ç‡§¶‡•Ä') ||
                (lang === 'en' && btn.textContent === 'English')) {
                btn.classList.add('active');
            }
        });
        this.render();
        this.showToast(`Language: ${lang.toUpperCase()}`);
    },

    t(key) {
        return dictionary[this.lang][key] || key;
    },

    translateProductName(name) {
        if (!name) return '';
        if (this.lang === 'en') return name;
        if (this.lang === 'bn') {
            return enToBnMap[name.toLowerCase()] || name;
        }
        if (this.lang === 'hi') {
            return enToHiMap[name.toLowerCase()] || name;
        }
        return name;
    },

    updateDate() {
        try {
            const now = new Date();
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            const dateStr = now.toLocaleDateString(
                this.lang === 'bn' ? 'bn-BD' : this.lang === 'hi' ? 'hi-IN' : 'en-IN', 
                options
            );
            const el = document.getElementById('currentDate');
            if (el) el.textContent = dateStr;
        } catch (e) {
            console.error('Date error:', e);
        }
    },

    navigate(view) {
        if (this.currentView === 'billing' && this.isScanning) {
            this.stopBarcodeScanner();
        }
        
        this.currentView = view;
        document.querySelectorAll('.nav-item').forEach(item => {
            item.classList.remove('active');
            if (item.getAttribute('data-nav') === view) {
                item.classList.add('active');
            }
        });
        this.render();
    },

    async saveProduct(product) {
        try {
            product.displayName = this.translateProductName(product.name);
            
            if (this.useLocalStorage || !this.db) {
                if (product.id) {
                    const idx = this.products.findIndex(p => p.id === product.id);
                    if (idx > -1) this.products[idx] = product;
                    else this.products.push(product);
                } else {
                    product.id = Date.now();
                    this.products.push(product);
                }
                localStorage.setItem('products', JSON.stringify(this.products));
            } else {
                await new Promise((resolve, reject) => {
                    const tx = this.db.transaction(['products'], 'readwrite');
                    const store = tx.objectStore('products');
                    const request = product.id ? store.put(product) : store.add(product);
                    request.onsuccess = () => {
                        if (!product.id) product.id = request.result;
                        resolve();
                    };
                    request.onerror = () => reject(request.error);
                });
                this.products = await this.getAllFromStore('products');
            }
            this.showToast(this.t('saved'));
        } catch (e) {
            console.error('Save product error:', e);
            this.showToast('Error saving product');
        }
    },

    async deleteProduct(id) {
        try {
            if (this.useLocalStorage || !this.db) {
                this.products = this.products.filter(p => p.id !== id);
                localStorage.setItem('products', JSON.stringify(this.products));
            } else {
                await new Promise((resolve, reject) => {
                    const tx = this.db.transaction(['products'], 'readwrite');
                    const store = tx.objectStore('products');
                    const request = store.delete(id);
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
                this.products = await this.getAllFromStore('products');
            }
            this.showToast(this.t('deleted'));
        } catch (e) {
            console.error('Delete error:', e);
            this.showToast('Error deleting');
        }
    },

    async saveSale(sale) {
        try {
            sale.date = new Date().toISOString();
            
            if (this.useLocalStorage || !this.db) {
                sale.id = Date.now();
                this.sales.push(sale);
                localStorage.setItem('sales', JSON.stringify(this.sales));
            } else {
                await new Promise((resolve, reject) => {
                    const tx = this.db.transaction(['sales'], 'readwrite');
                    const store = tx.objectStore('sales');
                    const request = store.add(sale);
                    request.onsuccess = () => resolve();
                    request.onerror = () => reject(request.error);
                });
                this.sales = await this.getAllFromStore('sales');
            }
        } catch (e) {
            console.error('Save sale error:', e);
        }
    },

    setupSpeechRecognition() {
        try {
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
            if (!SpeechRecognition) return;
            
            this.speechRecognition = new SpeechRecognition();
            this.speechRecognition.continuous = false;
            this.speechRecognition.interimResults = false;
            
            this.speechRecognition.onresult = (event) => {
                const transcript = event.results[0][0].transcript;
                this.handleVoiceInput(transcript);
                this.isRecording = false;
                this.updateVoiceButton();
            };
            
            this.speechRecognition.onerror = () => {
                this.showToast(this.t('voiceNotSupported'));
                this.isRecording = false;
                this.updateVoiceButton();
            };
            
            this.speechRecognition.onend = () => {
                this.isRecording = false;
                this.updateVoiceButton();
            };
        } catch (e) {
            console.error('Speech setup error:', e);
        }
    },

    toggleVoiceInput() {
        if (!this.speechRecognition) {
            this.showToast(this.t('voiceNotSupported'));
            return;
        }
        
        if (this.isRecording) {
            this.speechRecognition.stop();
            this.isRecording = false;
        } else {
            const langMap = { bn: 'bn-BD', hi: 'hi-IN', en: 'en-IN' };
            this.speechRecognition.lang = langMap[this.lang] || 'en-IN';
            this.speechRecognition.start();
            this.isRecording = true;
        }
        this.updateVoiceButton();
    },

    updateVoiceButton() {
        const btn = document.getElementById('voiceBtn');
        if (btn) {
            btn.classList.toggle('recording', this.isRecording);
            btn.innerHTML = this.isRecording ? 'üî¥ Listening...' : 'üé§ Voice Input';
        }
    },

    handleVoiceInput(transcript) {
        try {
            const words = transcript.toLowerCase().split(' ');
            let qty = 1;
            let unit = 'piece';
            let name = transcript;
            
            const numMatch = transcript.match(/(\d+)/);
            if (numMatch) {
                qty = parseInt(numMatch[1]);
                name = transcript.replace(numMatch[1], '').trim();
            }
            
            if (transcript.includes('kg') || transcript.includes('‡¶ï‡ßá‡¶ú‡¶ø')) unit = 'kg';
            else if (transcript.includes('litre') || transcript.includes('‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞')) unit = 'litre';
            
            name = name.replace(/kg|litre|‡¶™‡¶ø‡¶∏|‡¶ï‡ßá‡¶ú‡¶ø|‡¶≤‡¶ø‡¶ü‡¶æ‡¶∞/g, '').trim();
            
            const nameInput = document.getElementById('productName');
            if (nameInput) {
                nameInput.value = this.translateProductName(name);
                const qtyInput = document.getElementById('productQty');
                if (qtyInput) qtyInput.value = qty;
                const unitSelect = document.getElementById('productUnit');
                if (unitSelect) unitSelect.value = unit;
                this.showToast(`Detected: ${name}`);
            }
        } catch (e) {
            console.error('Voice handle error:', e);
        }
    },

    generateDailySummary() {
        try {
            const today = new Date().toDateString();
            const todaySales = this.sales.filter(s => new Date(s.date).toDateString() === today);
            const totalAmount = todaySales.reduce((sum, s) => sum + (s.total || 0), 0);
            
            const productCount = {};
            todaySales.forEach(sale => {
                if (sale.items) {
                    sale.items.forEach(item => {
                        productCount[item.name] = (productCount[item.name] || 0) + (item.qty || 0);
                    });
                }
            });
            
            let topProduct = '';
            let maxQty = 0;
            for (let [name, qty] of Object.entries(productCount)) {
                if (qty > maxQty) {
                    maxQty = qty;
                    topProduct = name;
                }
            }
            
            const lowStock = this.products.filter(p => (p.stock || 0) < 10);
            
            if (this.lang === 'bn') {
                let summary = `‡¶Ü‡¶ú ‡¶Æ‡ßã‡¶ü ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá ‚Çπ${totalAmount}‡•§ `;
                if (topProduct) summary += `‡¶∏‡¶¨‡¶ö‡ßá‡¶Ø‡¶º‡ßá ‡¶¨‡ßá‡¶∂‡¶ø ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá ${topProduct}‡•§ `;
                if (lowStock.length > 0) summary += `${lowStock.length}‡¶ü‡¶ø ‡¶™‡¶£‡ßç‡¶Ø‡ßá‡¶∞ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶ï‡¶Æ‡•§`;
                if (totalAmount > 5000) summary += " ‡¶Ü‡¶ú ‡¶≠‡¶æ‡¶≤‡ßã ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!";
                else if (totalAmount < 1000) summary += " ‡¶Ü‡¶ú ‡¶¨‡¶ø‡¶ï‡ßç‡¶∞‡¶ø ‡¶ï‡¶Æ‡•§ ‡¶ï‡¶æ‡¶≤ ‡¶Ü‡¶∞‡¶ì ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®‡•§";
                return summary;
            } else if (this.lang === 'hi') {
                let summary = `‡§Ü‡§ú ‡§ï‡•Å‡§≤ ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ‚Çπ${totalAmount} ‡§π‡•Å‡§à‡•§ `;
                if (topProduct) summary += `‡§∏‡§¨‡§∏‡•á ‡§ú‡•ç‡§Ø‡§æ‡§¶‡§æ ‡§¨‡§ø‡§ï‡•ç‡§∞‡•Ä ${topProduct} ‡§ï‡•Ä ‡§π‡•Å‡§à‡•§ `;
                if (lowStock.length > 0) summary += `${lowStock.length} ‡§â‡§§‡•ç‡§™‡§æ‡§¶‡•ã‡§Ç ‡§ï‡§æ ‡§∏‡•ç‡§ü‡•â‡§ï ‡§ï‡§Æ ‡§π‡•à‡•§`;
                return summary;
            } else {
                let summary = `Today's total sales: ‚Çπ${totalAmount}. `;
                if (topProduct) summary += `Top selling: ${topProduct}. `;
                if (lowStock.length > 0) summary += `${lowStock.length} products low on stock.`;
                return summary;
            }
        } catch (e) {
            console.error('Summary error:', e);
            return 'Error generating summary';
        }
    },

    getPurchaseSuggestions() {
        try {
            const sevenDaysAgo = new Date(Date.now() - 7 * 24 * 60 * 60 * 1000);
            const velocity = {};
            
            this.sales.forEach(sale => {
                if (new Date(sale.date) > sevenDaysAgo && sale.items) {
                    sale.items.forEach(item => {
                        velocity[item.name] = (velocity[item.name] || 0) + (item.qty || 0);
                    });
                }
            });
            
            const suggestions = this.products.filter(p => {
                const sold = velocity[p.displayName || p.name] || 0;
                return sold > 3 && (p.stock || 0) < sold * 2;
            }).map(p => ({
                name: p.displayName || p.name,
                currentStock: p.stock || 0,
                soldLast7Days: velocity[p.displayName || p.name] || 0,
                suggestedBuy: Math.ceil((velocity[p.displayName || p.name] || 0) * 2 - (p.stock || 0))
            }));
            
            return suggestions.sort((a, b) => b.soldLast7Days - a.soldLast7Days);
        } catch (e) {
            console.error('Suggestions error:', e);
            return [];
        }
    },

    async startBarcodeScanner() {
        try {
            if (!document.getElementById('reader')) {
                console.error('Reader element not found');
                return;
            }
            
            if (typeof Html5Qrcode === 'undefined') {
                this.showToast('Scanner library not loaded');
                return;
            }
            
            const html5QrCode = new Html5Qrcode("reader");
            this.html5QrCode = html5QrCode;
            
            const qrCodeSuccessCallback = (decodedText, decodedResult) => {
                this.handleBarcodeScan(decodedText);
            };
            
            const config = { fps: 10, qrbox: { width: 250, height: 250 } };
            
            await html5QrCode.start({ facingMode: "environment" }, config, qrCodeSuccessCallback);
            this.isScanning = true;
            
            const statusEl = document.getElementById('scannerStatus');
            if (statusEl) {
                statusEl.innerHTML = `<span style="color: var(--success);">‚óè Scanning...</span>`;
            }
            const scanBtn = document.getElementById('scanBtn');
            if (scanBtn) {
                scanBtn.textContent = this.t('stopScan');
                scanBtn.onclick = () => this.stopBarcodeScanner();
            }
            
        } catch (err) {
            console.error('Scanner error:', err);
            this.showToast(this.t('cameraError'));
            
            const statusEl = document.getElementById('scannerStatus');
            if (statusEl) {
                statusEl.innerHTML = `<span style="color: var(--danger);">‚úó ${this.t('cameraError')}</span>`;
            }
        }
    },

    async stopBarcodeScanner() {
        try {
            if (this.html5QrCode && this.isScanning) {
                await this.html5QrCode.stop();
                this.isScanning = false;
                
                const statusEl = document.getElementById('scannerStatus');
                if (statusEl) {
                    statusEl.innerHTML = `<span style="color: var(--text-light);">‚óã ${this.t('scannerStopped')}</span>`;
                }
                const scanBtn = document.getElementById('scanBtn');
                if (scanBtn) {
                    scanBtn.textContent = this.t('startScan');
                    scanBtn.onclick = () => this.startBarcodeScanner();
                }
            }
        } catch (e) {
            console.error('Stop scanner error:', e);
        }
    },

    handleBarcodeScan(barcode) {
        try {
            const product = this.products.find(p => p.barcode === barcode);
            
            if (product) {
                this.addProductToBillById(product.id);
                this.showToast(`${product.displayName || product.name} ${this.t('addedToBill')}`);
                this.stopBarcodeScanner();
                
                const resultDiv = document.getElementById('scanResult');
                if (resultDiv) {
                    resultDiv.innerHTML = `
                        <div class="scan-result">
                            <h4>‚úì ${this.t('productAdded')}</h4>
                            <p>${product.displayName || product.name}</p>
                            <p>Price: ‚Çπ${product.sellPrice || 0}</p>
                        </div>
                    `;
                }
            } else {
                const resultDiv = document.getElementById('scanResult');
                if (resultDiv) {
                    resultDiv.innerHTML = `
                        <div class="barcode-display">
                            Barcode: ${barcode}
                        </div>
                        <button class="btn btn-primary" onclick="app.openAddProductModal(null, '${barcode}')">
                            ${this.t('addProduct')} with this barcode
                        </button>
                    `;
                }
            }
        } catch (e) {
            console.error('Barcode handle error:', e);
        }
    },

    addProductWithBarcode(barcode) {
        this.openAddProductModal(null, barcode);
    },

    addProductToBillById(productId, qty = 1) {
        try {
            const product = this.products.find(p => p.id == productId);
            if (!product) return;
            
            const existing = this.currentBill.find(i => i.id == productId);
            if (existing) {
                existing.qty = (existing.qty || 0) + qty;
                existing.total = existing.qty * (existing.price || 0);
            } else {
                this.currentBill.push({
                    id: product.id,
                    name: product.displayName || product.name,
                    price: product.sellPrice || 0,
                    qty: qty,
                    unit: product.unit || 'piece',
                    total: (product.sellPrice || 0) * qty
                });
            }
            
            if (this.currentView === 'billing') {
                this.renderBilling(document.getElementById('mainContent'));
            }
        } catch (e) {
            console.error('Add to bill error:', e);
        }
    },

    generateUPIQR(amount) {
        try {
            const upiId = this.shopSettings.upiId;
            const merchantName = this.shopSettings.merchantName || 'Smart Mudi Khana';
            
            if (!upiId) {
                this.showToast('Please set UPI ID in settings first');
                return null;
            }
            
            const upiUrl = `upi://pay?pa=${encodeURIComponent(upiId)}&pn=${encodeURIComponent(merchantName)}&am=${amount}&cu=INR&tn=${encodeURIComponent('Payment at Smart Mudi Khana')}`;
            
            const qrContainer = document.getElementById('qrcode');
            if (qrContainer && typeof QRCode !== 'undefined') {
                qrContainer.innerHTML = '';
                
                new QRCode(qrContainer, {
                    text: upiUrl,
                    width: 250,
                    height: 250,
                    colorDark: "#000000",
                    colorLight: "#ffffff",
                    correctLevel: QRCode.CorrectLevel.H
                });
            }
            
            return upiUrl;
        } catch (e) {
            console.error('QR generate error:', e);
            return null;
        }
    },

    showUPIPaymentModal() {
        try {
            const total = this.currentBill.reduce((sum, item) => sum + (item.total || 0), 0);
            
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            if (!modalTitle || !modalBody) return;
            
            modalTitle.textContent = this.t('upiPayment');
            modalBody.innerHTML = `
                <div class="upi-qr-container">
                    <h3 style="margin-bottom: 16px;">${this.t('scanToPay')}</h3>
                    <div id="qrcode"></div>
                    <div class="upi-instructions">
                        <p><strong>Amount: ‚Çπ${total}</strong></p>
                        <p>${this.t('paymentApps')}</p>
                        <div class="payment-apps">
                            <div class="payment-app-icon" style="color: #4285F4;">G</div>
                            <div class="payment-app-icon" style="color: #5f259f;">P</div>
                            <div class="payment-app-icon" style="color: #00baf2;">P</div>
                            <div class="payment-app-icon" style="color: #f44336;">Pay</div>
                        </div>
                    </div>
                    ${!this.shopSettings.upiId ? `
                        <div style="margin-top: 16px; padding: 12px; background: #ffebee; border-radius: 8px; color: var(--danger);">
                            ‚ö†Ô∏è Please set your UPI ID in Settings first!
                        </div>
                    ` : ''}
                </div>
                <button class="btn btn-primary" onclick="app.closeModal()">
                    ${this.t('close')}
                </button>
            `;
            
            document.getElementById('modal').classList.add('active');
            
            if (total > 0 && this.shopSettings.upiId) {
                setTimeout(() => this.generateUPIQR(total), 100);
            }
        } catch (e) {
            console.error('UPI modal error:', e);
        }
    },

    openSettingsModal() {
        try {
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            if (!modalTitle || !modalBody) return;
            
            modalTitle.textContent = this.t('settings');
            modalBody.innerHTML = `
                <div class="settings-section">
                    <label class="settings-label">${this.t('upiId')}</label>
                    <input type="text" class="form-input" id="settingsUpiId" 
                           value="${this.shopSettings.upiId || ''}" 
                           placeholder="${this.t('enterUpiId')} (e.g., yourname@upi)">
                    <p class="settings-hint">Enter your UPI ID to receive payments</p>
                </div>
                
                <div class="settings-section">
                    <label class="settings-label">${this.t('merchantName')}</label>
                    <input type="text" class="form-input" id="settingsMerchantName" 
                           value="${this.shopSettings.merchantName || ''}" 
                           placeholder="Your Shop Name">
                </div>
                
                <button class="btn btn-primary" onclick="app.saveSettingsFromModal()">
                    ${this.t('save')}
                </button>
            `;
            
            document.getElementById('modal').classList.add('active');
        } catch (e) {
            console.error('Settings modal error:', e);
        }
    },

    saveSettingsFromModal() {
        try {
            const upiIdEl = document.getElementById('settingsUpiId');
            const merchantNameEl = document.getElementById('settingsMerchantName');
            
            const upiId = upiIdEl ? upiIdEl.value.trim() : '';
            const merchantName = merchantNameEl ? merchantNameEl.value.trim() : '';
            
            if (upiId && !upiId.includes('@')) {
                this.showToast('Invalid UPI ID. Must contain @');
                return;
            }
            
            this.shopSettings.upiId = upiId;
            this.shopSettings.merchantName = merchantName;
            this.saveSettings();
            this.showToast(this.t('saved'));
            this.closeModal();
        } catch (e) {
            console.error('Save settings error:', e);
        }
    },

    render() {
        try {
            const container = document.getElementById('mainContent');
            if (!container) return;
            
            switch(this.currentView) {
                case 'dashboard':
                    this.renderDashboard(container);
                    break;
                case 'inventory':
                    this.renderInventory(container);
                    break;
                case 'billing':
                    this.renderBilling(container);
                    break;
                case 'reports':
                    this.renderReports(container);
                    break;
            }
            this.updatePageText();
        } catch (e) {
            console.error('Render error:', e);
        }
    },

    updatePageText() {
        try {
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.getAttribute('data-key');
                if (dictionary[this.lang] && dictionary[this.lang][key]) {
                    el.textContent = dictionary[this.lang][key];
                }
            });
        } catch (e) {
            console.error('Update text error:', e);
        }
    },

    renderDashboard(container) {
        try {
            const today = new Date().toDateString();
            const todaySales = this.sales.filter(s => new Date(s.date).toDateString() === today);
            const todayTotal = todaySales.reduce((sum, s) => sum + (s.total || 0), 0);
            const lowStockCount = this.products.filter(p => (p.stock || 0) < 10).length;
            
            const summary = this.generateDailySummary();
            const suggestions = this.getPurchaseSuggestions();
            
            container.innerHTML = `
                <div class="ai-summary">
                    <h3>ü§ñ ${this.t('dailySummary')}</h3>
                    <p>${summary}</p>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">‚Çπ${todayTotal}</div>
                        <div class="stat-label">${this.t('todaySales')}</div>
                    </div>
                    <div class="stat-card ${lowStockCount > 0 ? 'warning' : ''}">
                        <div class="stat-value">${this.products.length}</div>
                        <div class="stat-label">${this.t('totalProducts')}</div>
                    </div>
                </div>
                
                ${lowStockCount > 0 ? `
                    <div class="stat-card danger" style="margin-bottom: 16px;">
                        <div class="stat-value">${lowStockCount}</div>
                        <div class="stat-label">${this.t('lowStockAlert')}</div>
                    </div>
                ` : ''}
                
                <div class="quick-actions">
                    <button class="action-btn" onclick="app.openAddProductModal()">
                        <span class="action-icon">‚ûï</span>
                        <span>${this.t('quickAdd')}</span>
                    </button>
                    <button class="action-btn" onclick="app.navigate('billing')">
                        <span class="action-icon">üßæ</span>
                        <span>${this.t('newBill')}</span>
                    </button>
                    <button class="action-btn" onclick="app.openSettingsModal()">
                        <span class="action-icon">‚öôÔ∏è</span>
                        <span>${this.t('settings')}</span>
                    </button>
                    <button class="action-btn" onclick="app.showUPIPaymentModal()">
                        <span class="action-icon">üì±</span>
                        <span>${this.t('receivePayment')}</span>
                    </button>
                </div>
                
                <div class="card">
                    <h3 class="card-title">üìà ${this.t('purchaseSuggestion')}</h3>
                    <div class="suggestions-container">
                        ${suggestions.length === 0 ? 
                            `<p style="color: var(--text-light); text-align: center;">‡¶∏‡¶¨ ‡¶∏‡ßç‡¶ü‡¶ï ‡¶†‡¶ø‡¶ï ‡¶Ü‡¶õ‡ßá / All stock OK</p>` :
                            suggestions.map(s => `
                                <span class="suggestion-chip" onclick="alert('${s.name}: Buy ${s.suggestedBuy} ${this.t('piece')}')">
                                    ${s.name}: ${s.suggestedBuy} ${this.t('piece')}
                                </span>
                            `).join('')
                        }
                    </div>
                </div>
            `;
        } catch (e) {
            console.error('Dashboard render error:', e);
            container.innerHTML = '<div class="error-message">Error loading dashboard</div>';
        }
    },

    renderInventory(container) {
        try {
            container.innerHTML = `
                <button class="btn btn-voice" id="voiceBtn" onclick="app.toggleVoiceInput()">
                    üé§ Voice Input
                </button>
                
                <div class="search-box">
                    <span class="search-icon">üîç</span>
                    <input type="text" class="search-input" placeholder="${this.t('search')}" 
                           oninput="app.filterProducts(this.value)">
                </div>
                
                <button class="btn btn-primary" onclick="app.openAddProductModal()">
                    ‚ûï ${this.t('addProduct')}
                </button>
                
                <div class="card">
                    <h3 class="card-title">üì¶ ${this.t('inventory')}</h3>
                    <div class="product-list" id="productList">
                        ${this.renderProductList(this.products)}
                    </div>
                </div>
            `;
        } catch (e) {
            console.error('Inventory render error:', e);
        }
    },

    renderProductList(products) {
        try {
            if (!products || products.length === 0) {
                return `
                    <div class="empty-state">
                        <div class="empty-icon">üì≠</div>
                        <p>${this.t('noProducts')}</p>
                    </div>
                `;
            }
            return products.map(p => `
                <div class="product-item ${(p.stock || 0) < 10 ? 'low-stock' : ''}" onclick="app.editProduct(${p.id})">
                    <div class="product-info">
                        <h4>${p.displayName || p.name} ${(p.stock || 0) < 10 ? '<span class="low-stock-badge">LOW</span>' : ''}</h4>
                        <p>Buy: ‚Çπ${p.buyPrice || 0} | Sell: ‚Çπ${p.sellPrice || 0} ${p.barcode ? '| Barcode: ' + p.barcode : ''}</p>
                    </div>
                    <div class="product-price">
                        <div class="price">‚Çπ${p.sellPrice || 0}</div>
                        <div class="stock">${p.stock || 0} ${this.t(p.unit) || p.unit || 'pcs'}</div>
                    </div>
                </div>
            `).join('');
        } catch (e) {
            console.error('Product list error:', e);
            return '<div class="error-message">Error loading products</div>';
        }
    },

    renderBilling(container) {
        try {
            const productOptions = this.products.map(p => 
                `<option value="${p.id}" data-price="${p.sellPrice || 0}" data-unit="${p.unit || 'piece'}">${p.displayName || p.name} (‚Çπ${p.sellPrice || 0}/${this.t(p.unit) || p.unit || 'pcs'})</option>`
            ).join('');
            
            const total = this.currentBill.reduce((sum, item) => sum + (item.total || 0), 0);
            
            container.innerHTML = `
                <div class="card">
                    <h3 class="card-title">üì∑ ${this.t('barcodeScanner')}</h3>
                    <div id="reader" style="width: 100%; min-height: 300px; background: #f5f5f5; border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                        <div class="scanner-error">
                            <p>Camera preview will appear here</p>
                            <p style="font-size: 0.8rem; margin-top: 8px;">Click Start Scan to activate</p>
                        </div>
                    </div>
                    <div id="scannerStatus" style="text-align: center; margin: 8px 0; font-size: 0.9rem;">
                        <span style="color: var(--text-light);">‚óã Scanner ready</span>
                    </div>
                    <button class="btn btn-info" id="scanBtn" onclick="app.startBarcodeScanner()">
                        ${this.t('startScan')}
                    </button>
                    <div id="scanResult"></div>
                </div>

                <div class="card">
                    <h3 class="card-title">üßæ ${this.t('createBill')}</h3>
                    
                    <div class="form-group">
                        <label class="form-label">${this.t('product')}</label>
                        <select class="form-select" id="billProduct" onchange="app.updateBillUnit()">
                            <option value="">-- Select Product --</option>
                            ${productOptions}
                        </select>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">${this.t('quantity')}</label>
                        <div class="input-group">
                            <input type="number" class="form-input" id="billQty" value="1" min="0.1" step="0.1">
                            <span id="billUnit" style="padding: 14px; color: var(--text-light); min-width: 60px;"></span>
                        </div>
                    </div>
                    
                    <button class="btn btn-primary" onclick="app.addToBill()">
                        ‚ûï ${this.t('addToBill')}
                    </button>
                </div>
                
                ${this.currentBill.length > 0 ? `
                    <div class="card">
                        <h3 class="card-title">üõí Bill Items</h3>
                        <div id="billItemsList">
                            ${this.renderBillItems()}
                        </div>
                        
                        <div class="bill-total">
                            <span class="bill-total-label">${this.t('billTotal')}</span>
                            <span class="bill-total-amount">‚Çπ${total}</span>
                        </div>
                        
                        <button class="btn btn-success mt-16" onclick="app.saveBill()">
                            üíæ ${this.t('save')} & ${this.t('printBill')}
                        </button>
                        <button class="btn btn-info" onclick="app.showUPIPaymentModal()">
                            üì± ${this.t('receivePayment')} (UPI)
                        </button>
                        <button class="btn btn-secondary" onclick="app.clearBill()">
                            üóëÔ∏è ${this.t('clearBill')}
                        </button>
                    </div>
                ` : ''}
            `;
        } catch (e) {
            console.error('Billing render error:', e);
            container.innerHTML = '<div class="error-message">Error loading billing</div>';
        }
    },

    renderBillItems() {
        try {
            return this.currentBill.map((item, idx) => `
                <div class="bill-item">
                    <div class="bill-item-details">
                        <div class="bill-item-name">${item.name || 'Unknown'}</div>
                        <div class="bill-item-calc">‚Çπ${item.price || 0} √ó ${item.qty || 0} ${this.t(item.unit) || item.unit || 'pcs'}</div>
                    </div>
                    <div class="bill-item-actions">
                        <button class="qty-btn" onclick="app.updateBillQty(${idx}, -1)">‚àí</button>
                        <span class="qty-display">${item.qty || 0}</span>
                        <button class="qty-btn" onclick="app.updateBillQty(${idx}, 1)">+</button>
                        <span style="font-weight: 700; min-width: 60px; text-align: right;">‚Çπ${item.total || 0}</span>
                        <button class="qty-btn" style="background: var(--danger);" onclick="app.removeFromBill(${idx})">‚úï</button>
                    </div>
                </div>
            `).join('');
        } catch (e) {
            console.error('Bill items error:', e);
            return '';
        }
    },

    renderReports(container) {
        try {
            const today = new Date();
            const todayStr = today.toDateString();
            const weekAgo = new Date(today - 7 * 24 * 60 * 60 * 1000);
            const monthAgo = new Date(today - 30 * 24 * 60 * 60 * 1000);
            
            const todaySales = this.sales.filter(s => new Date(s.date).toDateString() === todayStr);
            const weekSales = this.sales.filter(s => new Date(s.date) >= weekAgo);
            const monthSales = this.sales.filter(s => new Date(s.date) >= monthAgo);
            
            const todayTotal = todaySales.reduce((sum, s) => sum + (s.total || 0), 0);
            const weekTotal = weekSales.reduce((sum, s) => sum + (s.total || 0), 0);
            const monthTotal = monthSales.reduce((sum, s) => sum + (s.total || 0), 0);
            
            const productSales = {};
            this.sales.forEach(s => {
                if (s.items) {
                    s.items.forEach(i => {
                        productSales[i.name] = (productSales[i.name] || 0) + (i.qty || 0);
                    });
                }
            });
            
            const topProducts = Object.entries(productSales)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 5);
            
            container.innerHTML = `
                <div class="report-card">
                    <div class="report-title">${this.t('dailyReport')}</div>
                    <div class="report-value">‚Çπ${todayTotal}</div>
                    <div class="report-subtitle">${todaySales.length} transactions</div>
                </div>
                
                <div class="report-card">
                    <div class="report-title">${this.t('weeklyReport')}</div>
                    <div class="report-value">‚Çπ${weekTotal}</div>
                    <div class="report-subtitle">${weekSales.length} transactions</div>
                </div>
                
                <div class="report-card">
                    <div class="report-title">${this.t('monthlyReport')}</div>
                    <div class="report-value">‚Çπ${monthTotal}</div>
                    <div class="report-subtitle">${monthSales.length} transactions</div>
                </div>
                
                <div class="card">
                    <h3 class="card-title">üèÜ ${this.t('topProducts')}</h3>
                    ${topProducts.length === 0 ? '<p style="color: var(--text-light);">No data yet</p>' : 
                        topProducts.map(([name, qty], i) => `
                            <div style="display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px solid var(--border);">
                                <span>${i + 1}. ${name}</span>
                                <span style="font-weight: 600;">${qty} sold</span>
                            </div>
                        `).join('')
                    }
                </div>
                
                <button class="btn btn-primary" onclick="app.exportData()">
                    üì• Export Data (JSON)
                </button>
            `;
        } catch (e) {
            console.error('Reports render error:', e);
            container.innerHTML = '<div class="error-message">Error loading reports</div>';
        }
    },

    filterProducts(searchTerm) {
        try {
            const term = (searchTerm || '').toLowerCase();
            const filtered = this.products.filter(p => 
                (p.displayName || p.name || '').toLowerCase().includes(term) ||
                (p.name || '').toLowerCase().includes(term) ||
                (p.barcode && p.barcode.includes(term))
            );
            const list = document.getElementById('productList');
            if (list) list.innerHTML = this.renderProductList(filtered);
        } catch (e) {
            console.error('Filter error:', e);
        }
    },

    updateBillUnit() {
        try {
            const select = document.getElementById('billProduct');
            if (!select) return;
            const option = select.options[select.selectedIndex];
            const unitSpan = document.getElementById('billUnit');
            if (unitSpan && option && option.dataset.unit) {
                unitSpan.textContent = this.t(option.dataset.unit) || option.dataset.unit;
            }
        } catch (e) {
            console.error('Update unit error:', e);
        }
    },

    async addToBill() {
        try {
            const select = document.getElementById('billProduct');
            if (!select) return;
            
            const productId = select.value;
            if (!productId) {
                this.showToast('Please select a product');
                return;
            }
            
            const product = this.products.find(p => p.id == productId);
            const qtyInput = document.getElementById('billQty');
            const qty = parseFloat(qtyInput ? qtyInput.value : 1) || 1;
            
            if (!product) return;
            
            if ((product.stock || 0) < qty) {
                this.showToast(this.t('lowStockMsg'));
                return;
            }
            
            this.addProductToBillById(productId, qty);
            this.showToast(this.t('addedToBill'));
            this.renderBilling(document.getElementById('mainContent'));
        } catch (e) {
            console.error('Add to bill error:', e);
        }
    },

    updateBillQty(index, delta) {
        try {
            if (!this.currentBill[index]) return;
            const item = this.currentBill[index];
            item.qty = (item.qty || 0) + delta;
            if (item.qty <= 0) {
                this.currentBill.splice(index, 1);
            } else {
                item.total = item.qty * (item.price || 0);
            }
            this.renderBilling(document.getElementById('mainContent'));
        } catch (e) {
            console.error('Update qty error:', e);
        }
    },

    removeFromBill(index) {
        try {
            this.currentBill.splice(index, 1);
            this.renderBilling(document.getElementById('mainContent'));
        } catch (e) {
            console.error('Remove error:', e);
        }
    },

    async saveBill() {
        try {
            if (this.currentBill.length === 0) return;
            
            const total = this.currentBill.reduce((sum, item) => sum + (item.total || 0), 0);
            const sale = {
                items: [...this.currentBill],
                total: total,
                timestamp: new Date().toISOString()
            };
            
            await this.saveSale(sale);
            
            for (let item of this.currentBill) {
                const product = this.products.find(p => p.id === item.id);
                if (product) {
                    product.stock = (product.stock || 0) - (item.qty || 0);
                    await this.saveProduct(product);
                }
            }
            
            this.printBill();
            this.currentBill = [];
            this.showToast('Bill saved! / ‡¶¨‡¶ø‡¶≤ ‡¶∏‡ßá‡¶≠ ‡¶π‡¶Ø‡¶º‡ßá‡¶õ‡ßá!');
            this.render();
        } catch (e) {
            console.error('Save bill error:', e);
            this.showToast('Error saving bill');
        }
    },

    printBill() {
        try {
            const total = this.currentBill.reduce((sum, item) => sum + (item.total || 0), 0);
            const date = new Date().toLocaleString();
            
            const billHTML = `
                <div style="font-family: monospace; max-width: 300px; margin: 0 auto; padding: 20px; border: 1px dashed #000;">
                    <h2 style="text-align: center; margin-bottom: 10px; font-size: 18px;">Smart Mudi Khana</h2>
                    <p style="text-align: center; font-size: 12px; margin-bottom: 20px;">${date}</p>
                    <hr style="border: 1px dashed #000; margin: 10px 0;">
                    ${this.currentBill.map(item => `
                        <div style="display: flex; justify-content: space-between; margin: 5px 0; font-size: 14px;">
                            <span>${item.name || 'Unknown'} x${item.qty || 0}</span>
                            <span>‚Çπ${item.total || 0}</span>
                        </div>
                    `).join('')}
                    <hr style="border: 1px dashed #000; margin: 10px 0;">
                    <div style="display: flex; justify-content: space-between; font-weight: bold; font-size: 16px;">
                        <span>TOTAL</span>
                        <span>‚Çπ${total}</span>
                    </div>
                    <hr style="border: 1px dashed #000; margin: 10px 0;">
                    <p style="text-align: center; font-size: 12px; margin-top: 20px;">‡¶ß‡¶®‡ßç‡¶Ø‡¶¨‡¶æ‡¶¶ / Thank You / ‡§ß‡§®‡•ç‡§Ø‡§µ‡§æ‡§¶</p>
                </div>
            `;
            
            const printWindow = window.open('', '_blank');
            if (printWindow) {
                printWindow.document.write(`
                    <html>
                        <head><title>Bill</title></head>
                        <body onload="window.print(); window.close();">
                            ${billHTML}
                        </body>
                    </html>
                `);
                printWindow.document.close();
            }
        } catch (e) {
            console.error('Print error:', e);
        }
    },

    clearBill() {
        try {
            if (confirm('Clear bill? / ‡¶¨‡¶ø‡¶≤ ‡¶Æ‡ßÅ‡¶õ‡¶¨‡ßá‡¶®?')) {
                this.currentBill = [];
                this.render();
            }
        } catch (e) {
            console.error('Clear bill error:', e);
        }
    },

    openAddProductModal(product = null, barcode = null) {
        try {
            const isEdit = !!product;
            const units = ['kg', 'litre', 'packet', 'piece'];
            
            const modalTitle = document.getElementById('modalTitle');
            const modalBody = document.getElementById('modalBody');
            
            if (!modalTitle || !modalBody) return;
            
            modalTitle.textContent = isEdit ? this.t('edit') : this.t('addProduct');
            modalBody.innerHTML = `
                <div class="form-group">
                    <label class="form-label">${this.t('productName')}</label>
                    <input type="text" class="form-input" id="productName" value="${product ? product.name : ''}" 
                           placeholder="e.g., Rice, Sugar, Oil">
                    <small style="color: var(--text-light); display: block; margin-top: 4px;">
                        English type ‡¶ï‡¶∞‡¶≤‡ßá auto Bengali ‡¶π‡¶¨‡ßá
                    </small>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Barcode (Optional)</label>
                    <input type="text" class="form-input" id="productBarcode" value="${product ? (product.barcode || '') : (barcode || '')}" 
                           placeholder="Scan or enter barcode">
                </div>
                
                <div class="form-group">
                    <label class="form-label">${this.t('buyPrice')} (‚Çπ)</label>
                    <input type="number" class="form-input" id="buyPrice" value="${product ? (product.buyPrice || '') : ''}" step="0.01">
                </div>
                
                <div class="form-group">
                    <label class="form-label">${this.t('sellPrice')} (‚Çπ)</label>
                    <input type="number" class="form-input" id="sellPrice" value="${product ? (product.sellPrice || '') : ''}" step="0.01">
                </div>
                
                <div class="form-group">
                    <label class="form-label">${this.t('stockQty')}</label>
                    <input type="number" class="form-input" id="productQty" value="${product ? (product.stock || '') : ''}" step="0.1">
                </div>
                
                <div class="form-group">
                    <label class="form-label">${this.t('unit')}</label>
                    <select class="form-select" id="productUnit">
                        ${units.map(u => `<option value="${u}" ${product && product.unit === u ? 'selected' : ''}>${this.t(u)}</option>`).join('')}
                    </select>
                </div>
                
                <button class="btn btn-primary" onclick="app.saveProductFromModal(${product ? product.id : 'null'})">
                    ${this.t('save')}
                </button>
                ${isEdit ? `<button class="btn btn-danger" onclick="app.confirmDelete(${product.id})">${this.t('delete')}</button>` : ''}
            `;
            
            document.getElementById('modal').classList.add('active');
        } catch (e) {
            console.error('Modal error:', e);
        }
    },

    async saveProductFromModal(id) {
        try {
            const nameEl = document.getElementById('productName');
            const barcodeEl = document.getElementById('productBarcode');
            const buyPriceEl = document.getElementById('buyPrice');
            const sellPriceEl = document.getElementById('sellPrice');
            const stockEl = document.getElementById('productQty');
            const unitEl = document.getElementById('productUnit');
            
            const name = nameEl ? nameEl.value.trim() : '';
            const barcode = barcodeEl ? barcodeEl.value.trim() : '';
            const buyPrice = parseFloat(buyPriceEl ? buyPriceEl.value : 0) || 0;
            const sellPrice = parseFloat(sellPriceEl ? sellPriceEl.value : 0) || 0;
            const stock = parseFloat(stockEl ? stockEl.value : 0) || 0;
            const unit = unitEl ? unitEl.value : 'piece';
            
            if (!name) {
                this.showToast('Please enter product name');
                return;
            }
            
            const product = { 
                id: id || Date.now(), 
                name, 
                barcode: barcode || null,
                buyPrice, 
                sellPrice, 
                stock, 
                unit,
                displayName: this.translateProductName(name)
            };
            
            await this.saveProduct(product);
            this.closeModal();
            this.render();
        } catch (e) {
            console.error('Save from modal error:', e);
            this.showToast('Error saving product');
        }
    },

    editProduct(id) {
        try {
            const product = this.products.find(p => p.id === id);
            if (product) this.openAddProductModal(product);
        } catch (e) {
            console.error('Edit error:', e);
        }
    },

    confirmDelete(id) {
        try {
            if (confirm('Are you sure? / ‡¶Ü‡¶™‡¶®‡¶ø ‡¶ï‡¶ø ‡¶®‡¶ø‡¶∂‡ßç‡¶ö‡¶ø‡¶§?')) {
                this.deleteProduct(id);
                this.closeModal();
                this.render();
            }
        } catch (e) {
            console.error('Confirm delete error:', e);
        }
    },

    closeModal() {
        try {
            const modal = document.getElementById('modal');
            if (modal) modal.classList.remove('active');
        } catch (e) {
            console.error('Close modal error:', e);
        }
    },

    exportData() {
        try {
            const data = { 
                products: this.products, 
                sales: this.sales, 
                exportDate: new Date().toISOString() 
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `mudikhana_backup_${new Date().toISOString().split('T')[0]}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            this.showToast('Data exported!');
        } catch (e) {
            console.error('Export error:', e);
            this.showToast('Error exporting data');
        }
    },

    showToast(message) {
        try {
            const toast = document.getElementById('toast');
            if (!toast) return;
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        } catch (e) {
            console.error('Toast error:', e);
        }
    }
};

if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', () => {
        app.init();
    });
} else {
    app.init();
}